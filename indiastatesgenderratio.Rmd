---
output: html_document
---

<style>
    body .main-container {
        max-width: 100%;
        padding: 0;
        margin: 0;
    }
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r, echo=FALSE, message=F, warning=F, results = 'hide'}
library("leaflet")
library("rgdal")
library("rvest")
library("tidyverse")
library("ggmap")
library("raster")
library("sp")
library("htmlwidgets")

states <- readOGR("data/IndiaAdminUnits/States.shp")

url <- 'https://en.wikipedia.org/wiki/List_of_states_and_union_territories_of_India_by_sex_ratio'
ratio <- url %>%
  read_html() %>%
  html_nodes(xpath = '//*[@id="mw-content-text"]/div/table[2]') %>%
  html_table()
ratio <- ratio[[1]][-1,]
ratio <- ratio[-c(1,4:10)]
row.names(ratio) <- NULL
names(ratio)[1] <- "State Name"
worst <- as.integer(tail(ratio[2],1))
worst <- worst-1
ratio$`2011 Census` <- as.integer(ratio$`2011 Census`)
colors <- rainbow(head(ratio[2],1) - tail(ratio[2],1), alpha = 0.5)
ratio$`State Name`[33] = "NCT of Delhi"
ratio <- ratio[order(ratio[1]),]
states <- states[order(states$ST_NM),]

colourIndex = c(ratio$`2011 Census`- worst)

states[["ColourIndex"]] <- colourIndex
```

## {.tabset}
### States of India

```{r, echo=FALSE, warning=F}
mapsrin_col2Hex <- function(col) {
    mat <- grDevices::col2rgb(col, alpha = TRUE)
    grDevices::rgb(mat[1, ]/255, mat[2, ]/255, mat[3,]/255)
}


map <- leaflet(width = "100%") %>% 
  addProviderTiles("Esri") %>% 
  addPolygons(data = states, 
              color = "#000000", 
              weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.8,
              dashArray = "3",
              fillColor = mapsrin_col2Hex(colors[states$ColourIndex]),
              label = ~states$ST_NM,
              highlightOptions = highlightOptions(color = "white", weight = 2),
              popup = paste0("<strong>State name: </strong>",
                             states$ST_NM)) %>%
  addMiniMap(tiles = providers$Esri, toggleDisplay = TRUE) %>% 
  addScaleBar() %>%
  addSimpleGraticule(showOriginLabel = TRUE)
map
```

### Data

```{r}
library(DT)
datatable(states@data, options = list(pageLength = 100))
```

### Info

Shape files from:
Demo of 4 colour theorem